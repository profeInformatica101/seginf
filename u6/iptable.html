    <!DOCTYPE html>
    <html lang="es">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>IPTables - Estados y Configuraci√≥n</title>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <style>
            pre {
                position: relative;
            }
            .copy-btn {
                position: absolute;
                top: 10px;
                right: 10px;
                cursor: pointer;
                background: #444;
                color: white;
                border: none;
                padding: 5px 10px;
                border-radius: 5px;
            }
            .copy-btn:hover {
                background: #666;
            }
            .container-fluid{
                background-color: bisque;
            }
        </style>
    </head>
    <body class="bg-light">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-light bg-light sticky-top">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">üõ°Ô∏è IPTables</a>
                <ul class="navbar-nav">
                    <li class="nav-item"><a class="nav-link" href="#estados">Estados</a></li>
                    <li class="nav-item"><a class="nav-link" href="#reglas">Reglas</a></li>
                    <li class="nav-item"><a class="nav-link" href="#ejercicios">Ejercicios</a></li>
                    <li class="nav-item"><a class="nav-link" href="#diagramas">Diagramas</a></li>
                    <li class="nav-item"><a class="nav-link" href="#ufw">UFW</a></li>
                </ul>
            </div>
        </nav>

        <!-- Contenido Principal -->
<!-- Contenido Principal -->
<div class="container mt-5">
    <h1 class="text-center text-primary">üîí IPTables - Estados y Configuraci√≥n</h1>
    <p class="lead text-center">Aprende a configurar y gestionar reglas de IPTables en un entorno controlado y seguro.</p>
    
    <!-- Introducci√≥n -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">¬øQu√© es IPTables? üõ°Ô∏è</h2>
            <p class="card-text">
                IPTables es una herramienta utilizada en sistemas Linux para gestionar reglas de cortafuegos (firewall). Permite definir qu√© tr√°fico de red est√° permitido o bloqueado, garantizando la seguridad del sistema.
            </p>
            <p>üîπ IPTables usa reglas organizadas en <strong>tablas</strong> y <strong>cadenas</strong> que controlan el tr√°fico de red. A continuaci√≥n, exploraremos c√≥mo listar reglas, establecer pol√≠ticas y configurar reglas espec√≠ficas. üöÄ</p>
        </div>
    </div>

    <!-- Listar Reglas Actuales -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">üìã Listar las reglas actuales</h2>
            <p>Para ver las reglas configuradas en el cortafuegos y entender qu√© tr√°fico est√° permitido o bloqueado, usa el siguiente comando:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo iptables -L -n -v</code></pre>
            <p>üîπ Este comando mostrar√° una lista detallada de las reglas activas en el sistema.</p>
        </div>
    </div>

    <!-- Establecer Pol√≠ticas Predeterminadas -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">‚öôÔ∏è Establecer pol√≠ticas predeterminadas</h2>
            <p>Para mejorar la seguridad, es recomendable definir pol√≠ticas predeterminadas. Un buen punto de partida es:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>
sudo iptables -P INPUT DROP  # Bloquea tr√°fico entrante no autorizado
sudo iptables -P FORWARD DROP  # Bloquea tr√°fico reenviado
sudo iptables -P OUTPUT ACCEPT  # Permite todo el tr√°fico saliente</code></pre>
            <p>üìå <strong>Explicaci√≥n:</strong></p>
            <ul>
                <li><strong>INPUT DROP</strong>: Bloquea conexiones entrantes no especificadas en otras reglas.</li>
                <li><strong>FORWARD DROP</strong>: Bloquea tr√°fico que se reenv√≠a a otros dispositivos.</li>
                <li><strong>OUTPUT ACCEPT</strong>: Permite que el sistema env√≠e tr√°fico sin restricciones.</li>
            </ul>
        </div>
    </div>

    <!-- Reglas B√°sicas -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">üéØ Reglas b√°sicas de IPTables</h2>
            <p>Las reglas de IPTables permiten definir qu√© tr√°fico se acepta o bloquea. Aqu√≠ tienes algunas reglas esenciales:</p>
            
            <h3>1Ô∏è‚É£ Permitir tr√°fico SSH (Puerto 22)</h3>
            <p>Para permitir conexiones SSH en el puerto 22 y evitar bloqueos accidentales:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo iptables -A INPUT -p tcp --dport 22 -j ACCEPT</code></pre>

            <h3>2Ô∏è‚É£ Permitir tr√°fico desde una IP espec√≠fica</h3>
            <p>Si quieres aceptar tr√°fico solo de una direcci√≥n IP concreta, como 192.168.1.100:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo iptables -A INPUT -s 192.168.1.100 -j ACCEPT</code></pre>

            <h3>3Ô∏è‚É£ Bloquear tr√°fico hacia una IP espec√≠fica</h3>
            <p>Para denegar el tr√°fico de salida a una IP concreta, por ejemplo, 203.0.113.1:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo iptables -A OUTPUT -d 203.0.113.1 -j REJECT</code></pre>

            <h3>4Ô∏è‚É£ Limitar intentos de conexi√≥n SSH (Evitar fuerza bruta) üîê</h3>
            <p>Para evitar ataques por fuerza bruta en SSH, limita el n√∫mero de intentos por IP:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>
sudo iptables -A INPUT -p tcp --dport 22 -m recent --set --name SSH
sudo iptables -A INPUT -p tcp --dport 22 -m recent --update --seconds 60 --hitcount 4 --name SSH -j DROP</code></pre>

            <h3>5Ô∏è‚É£ Permitir tr√°fico web (HTTP y HTTPS)</h3>
            <p>Si el servidor ejecuta una p√°gina web, habilita los puertos 80 y 443:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>
sudo iptables -A INPUT -p tcp --dport 80 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 443 -j ACCEPT</code></pre>
        </div>
    </div>

    <!-- Guardar reglas para persistencia -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">üíæ Guardar reglas de IPTables</h2>
            <p>Por defecto, las reglas de IPTables desaparecen tras reiniciar el sistema. Para hacerlas persistentes en Debian/Ubuntu:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo apt install iptables-persistent</code></pre>
            <p>Para guardar las reglas manualmente:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo iptables-save > /etc/iptables/rules.v4</code></pre>
            <p>Y para restaurarlas en cada reinicio:</p>
            <pre class="bg-dark text-white p-3 rounded"><code>sudo iptables-restore < /etc/iptables/rules.v4</code></pre>
        </div>
    </div>

    <!-- Buenas pr√°cticas -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">‚úÖ Buenas pr√°cticas con IPTables</h2>
            <ul>
                <li>üõ†Ô∏è **Define reglas espec√≠ficas antes de las generales** para evitar bloqueos inesperados.</li>
                <li>üìú **Registra el tr√°fico sospechoso antes de bloquearlo**, usando `LOG`:</li>
                <pre class="bg-dark text-white p-3 rounded"><code>iptables -A INPUT -p tcp --dport 23 -j LOG --log-prefix "Telnet bloqueado: "</code></pre>
                <li>üìå **Usa listas blancas en lugar de listas negras**, permitiendo solo tr√°fico necesario.</li>
                <li>üöÄ **Testea las reglas antes de aplicarlas permanentemente**.</li>
            </ul>
        </div>
    </div>

    <!-- Conclusi√≥n -->
    <div class="card mb-4 shadow">
        <div class="card-body">
            <h2 class="card-title">üéØ Conclusi√≥n</h2>
            <p>IPTables es una herramienta fundamental en la seguridad de redes Linux. Con estas configuraciones b√°sicas, ya puedes gestionar tr√°fico de manera segura. ¬°Practica y mejora tus reglas! üî•</p>
        </div>
    </div>


            <!-- Casos de Estudio -->
<div class="card shadow mb-4">
    <div class="card-header bg-success text-white">üìÇ Casos de Estudio</div>
    <div class="card-body">
        <p>Estos casos de estudio utilizan el script proporcionado para configurar un entorno de red con IPTables.</p>
        
        <!-- Caso 1: Firewall B√°sico -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#caso1">
                    Caso 1: Configurar un Firewall B√°sico en Endian_UTM
                </button>
            </h2>
            <div id="caso1" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <p><strong>Objetivo:</strong> Permitir tr√°fico SSH y bloquear el resto.</p>
                    <pre class="bg-dark text-white p-3 rounded">
    # Permitir SSH desde la red GREEN
    iptables -A INPUT -p tcp --dport 22 -s 192.168.1.0/24 -j ACCEPT

    # Bloquear todo el tr√°fico entrante no permitido
    iptables -A INPUT -j DROP
                    </pre>
                </div>
            </div>
        </div>

        <!-- Caso 2: DMZ Segura -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#caso2">
                    Caso 2: Crear una DMZ Segura en Public_Web
                </button>
            </h2>
            <div id="caso2" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <p><strong>Objetivo:</strong> Permitir tr√°fico HTTP/HTTPS y bloquear el resto.</p>
                    <pre class="bg-dark text-white p-3 rounded">
    # Permitir HTTP y HTTPS
    iptables -A INPUT -p tcp --dport 80 -j ACCEPT
    iptables -A INPUT -p tcp --dport 443 -j ACCEPT

    # Bloquear todo el tr√°fico entrante no permitido
    iptables -A INPUT -j DROP
                    </pre>
                </div>
            </div>
        </div>

        <!-- Caso 3: NAT en Endian_UTM -->
        <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#caso3">
                    Caso 3: Configurar NAT en Endian_UTM
                </button>
            </h2>
            <div id="caso3" class="accordion-collapse collapse">
                <div class="accordion-body">
                    <p><strong>Objetivo:</strong> Permitir que las m√°quinas en la red GREEN accedan a Internet.</p>
                    <pre class="bg-dark text-white p-3 rounded">
    # Habilitar NAT
    iptables -t nat -A POSTROUTING -o eth3 -j MASQUERADE
                    </pre>
                </div>
            </div>
        </div>
    </div>
</div>




<!-- Glosario Interactivo -->
<div class="card shadow mb-4">
    <div class="card-header bg-info text-white">üìö Glosario Interactivo</div>
    <div class="card-body">
        <div class="accordion" id="glosarioAccordion">
            <!-- DNAT -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#dnat">
                        DNAT (Destination Network Address Translation)
                    </button>
                </h2>
                <div id="dnat" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <p><strong>DNAT</strong> se utiliza para redirigir paquetes a una direcci√≥n IP y puerto espec√≠ficos. Es com√∫n en servidores que reciben tr√°fico desde Internet.</p>
                        <pre class="bg-dark text-white p-3 rounded">
    # Ejemplo de DNAT
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.1.10:80
                        </pre>
                    </div>
                </div>
            </div>
            <!-- SNAT -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#snat">
                        SNAT (Source Network Address Translation)
                    </button>
                </h2>
                <div id="snat" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <p><strong>SNAT</strong> modifica la direcci√≥n IP de origen de los paquetes antes de enviarlos a Internet. Se usa com√∫nmente en firewalls para permitir que las redes internas accedan a Internet.</p>
                        <pre class="bg-dark text-white p-3 rounded">
    # Ejemplo de SNAT
    iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 203.0.113.1
                        </pre>
                    </div>
                </div>
            </div>
            <!-- Stateful vs Stateless Firewall -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#stateful">
                        Stateful vs Stateless Firewall
                    </button>
                </h2>
                <div id="stateful" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <p><strong>Stateful Firewall:</strong> Mantiene un registro de las conexiones activas y permite el tr√°fico relacionado. IPTables es un firewall stateful.</p>
                        <p><strong>Stateless Firewall:</strong> No mantiene un registro de conexiones. Cada paquete se eval√∫a de forma independiente.</p>
                    </div>
                </div>
            </div>
            <!-- Tipos de Ataques -->
            <div class="accordion-item">
                <h2 class="accordion-header">
                    <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#ataques">
                        Tipos de Ataques que IPTables Puede Mitigar
                    </button>
                </h2>
                <div id="ataques" class="accordion-collapse collapse">
                    <div class="accordion-body">
                        <ul>
                            <li><strong>Escaneo de Puertos:</strong> Bloquear intentos de escaneo con reglas espec√≠ficas.</li>
                            <li><strong>DDoS:</strong> Limitar el n√∫mero de conexiones por IP.</li>
                            <li><strong>IP Spoofing:</strong> Filtrar paquetes con direcciones IP falsificadas.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Secci√≥n de Reglas de IPTables -->
    <div class="card shadow mb-4" id="reglas">
        <br><br>
        <h2>Reglas:</h2>
        <div class="card-header bg-info text-white">Reglas de IPTables</div>
   
        <div class="card-body">
            <p>Las reglas de IPTables se organizan en <strong>cadenas</strong> (chains) que definen c√≥mo se maneja el tr√°fico. Las cadenas principales son:</p>
            <ul>
                <li><strong>INPUT:</strong> Para tr√°fico entrante al servidor.</li>
                <li><strong>OUTPUT:</strong> Para tr√°fico saliente del servidor.</li>
                <li><strong>FORWARD:</strong> Para tr√°fico que se reenv√≠a a trav√©s del servidor.</li>
            </ul>
            <p>Las reglas se aplican en orden, y pueden realizar las siguientes acciones:</p>
            <ul>
                <li><strong>ACCEPT:</strong> Permitir el tr√°fico.</li>
                <li><strong>DROP:</strong> Descartar el tr√°fico sin notificar al remitente.</li>
                <li><strong>REJECT:</strong> Rechazar el tr√°fico y notificar al remitente.</li>
                <li><strong>LOG:</strong> Registrar el tr√°fico en los logs.</li>
            </ul>
            <p>Ejemplo de reglas comunes:</p>
            <pre class="bg-dark text-white p-3 rounded">
    # Permitir tr√°fico SSH (puerto 22)
    iptables -A INPUT -p tcp --dport 22 -j ACCEPT

    # Permitir tr√°fico HTTP (puerto 80) y HTTPS (puerto 443)
    iptables -A INPUT -p tcp --dport 80 -j ACCEPT
    iptables -A INPUT -p tcp --dport 443 -j ACCEPT

    # Bloquear todo el tr√°fico entrante no permitido
    iptables -A INPUT -j DROP

    # Habilitar NAT para una red interna
    iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>
    <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">Tipos de Reglas en IPTables</div>
        <div class="card-body">
            <p>IPTables maneja diferentes reglas organizadas en <strong>tablas</strong> y <strong>cadenas</strong>. A continuaci√≥n, se presentan los principales tipos de reglas:</p>
            <ul>
                <li><strong>Reglas de Filtrado (filter):</strong> Controlan el tr√°fico permitido o bloqueado.</li>
                <li><strong>Reglas de NAT (nat):</strong> Modifican direcciones IP y puertos en los paquetes.</li>
                <li><strong>Reglas de Mangle (mangle):</strong> Alteran bits en los paquetes para QoS o routing avanzado.</li>
                <li><strong>Reglas de Raw (raw):</strong> Excluyen paquetes del seguimiento de conexiones.</li>
                <li><strong>Reglas de Seguridad (security):</strong> Aplican pol√≠ticas de seguridad reforzada.</li>
            </ul>
            <h5 class="mt-3">Ejemplo de Reglas:</h5>
            <pre class="bg-dark text-white p-3 rounded">
    # Reglas de filtrado
    iptables -A INPUT -p tcp --dport 80 -j ACCEPT
    iptables -A FORWARD -p tcp --dport 22 -j DROP

    # Reglas de NAT
    iptables -t nat -A POSTROUTING -o eth0 -j MASQUERADE

    # Reglas de Mangle
    iptables -t mangle -A PREROUTING -p tcp --dport 443 -j TOS --set-tos 0x10
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>

            <!-- Secci√≥n de Estados -->
            <div id="estados" class="card shadow mb-4">
                <div class="card-header bg-primary text-white">Estados en IPTables</div>
                <div class="card-body">
                    <img src="img/estadosIPTable.png" alt="Imagen estados iptable">

                    <ul>
                        <li><strong>NEW:</strong> Indica que el paquete es el inicio de una nueva conexi√≥n.</li>
                        <li><strong>ESTABLISHED:</strong> Paquete pertenece a una conexi√≥n ya establecida.</li>
                        <li><strong>RELATED:</strong> Conexi√≥n relacionada con otra ya existente.</li>
                        <li><strong>INVALID:</strong> Paquete desconocido o mal formado.</li>
                        <li><strong>UNTRACKED:</strong> Excluido del seguimiento de conexiones.</li>
                    </ul>
                </div>
            </div>


<!---EJERCCIOS-->

<div  id="ejercicios">
    <br><br>
            <h3 class="text-center text-secondary">Ejercicios Pr√°cticos con Soluciones en IPTables</h3>
            <p class="text-center">Estos ejercicios est√°n dise√±ados para aplicarse en las m√°quinas virtuales creadas, especialmente en <strong>Endian_UTM</strong> (el firewall) y <strong>Public_Web</strong> (el servidor en la DMZ).</p>
            <div class="accordion" id="accordionExercises">
                <!-- Ejercicio 1 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#exercise1">Ejercicio 1: Configurar un Firewall B√°sico en Endian_UTM</button>
                    </h2>
                    <div id="exercise1" class="accordion-collapse collapse show" data-bs-parent="#accordionExercises">
                        <div class="accordion-body">
                            <p><strong>Objetivo:</strong> Configurar reglas b√°sicas de IPTables para permitir tr√°fico SSH y bloquear el resto.</p>
                            <pre class="bg-dark text-white p-3 rounded">
            # Permitir tr√°fico SSH (puerto 22) desde la red GREEN (192.168.1.0/24)
            iptables -A INPUT -p tcp --dport 22 -s 192.168.1.0/24 -j ACCEPT
            
            # Permitir tr√°fico ESTABLISHED y RELATED
            iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
            
            # Bloquear todo el tr√°fico entrante no permitido
            iptables -A INPUT -j DROP
            
            # Guardar las reglas
            iptables-save > /etc/iptables/rules.v4
                            </pre>
                        </div>
                    </div>
                </div>
                <!-- Ejercicio 2 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise2">Ejercicio 2: Permitir Tr√°fico HTTP/HTTPS en Public_Web</button>
                    </h2>
                    <div id="exercise2" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
                        <div class="accordion-body">
                            <p><strong>Objetivo:</strong> Configurar IPTables para permitir tr√°fico web en el servidor Public_Web.</p>
                            <pre class="bg-dark text-white p-3 rounded">
            # Permitir tr√°fico HTTP (puerto 80) y HTTPS (puerto 443)
            iptables -A INPUT -p tcp --dport 80 -j ACCEPT
            iptables -A INPUT -p tcp --dport 443 -j ACCEPT
            
            # Permitir tr√°fico ESTABLISHED y RELATED
            iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
            
            # Bloquear todo el tr√°fico entrante no permitido
            iptables -A INPUT -j DROP
            
            # Guardar las reglas
            iptables-save > /etc/iptables/rules.v4
                            </pre>
                        </div>
                    </div>
                </div>
                <!-- Ejercicio 3 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise3">Ejercicio 3: Configurar NAT en Endian_UTM</button>
                    </h2>
                    <div id="exercise3" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
                        <div class="accordion-body">
                            <p><strong>Objetivo:</strong> Permitir que las m√°quinas en la red GREEN accedan a Internet.</p>
                            <pre class="bg-dark text-white p-3 rounded">
            # Habilitar el forwarding de paquetes
            echo 1 > /proc/sys/net/ipv4/ip_forward
            
            # Configurar NAT para la red GREEN
            iptables -t nat -A POSTROUTING -o eth3 -j MASQUERADE
            
            # Permitir tr√°fico desde GREEN a WAN
            iptables -A FORWARD -i eth1 -o eth3 -j ACCEPT
            
            # Guardar las reglas
            iptables-save > /etc/iptables/rules.v4
                            </pre>
                        </div>
                    </div>
                </div>
                <!-- Ejercicio 4 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise4">Ejercicio 4: Bloquear Tr√°fico ICMP en PC1_LAN</button>
                    </h2>
                    <div id="exercise4" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
                        <div class="accordion-body">
                            <p><strong>Objetivo:</strong> Configurar IPTables para bloquear tr√°fico ICMP en PC1_LAN.</p>
                            <pre class="bg-dark text-white p-3 rounded">
            # Bloquear tr√°fico ICMP (ping)
            iptables -A INPUT -p icmp --icmp-type echo-request -j DROP
            
            # Permitir tr√°fico ESTABLISHED y RELATED
            iptables -A INPUT -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
            
            # Guardar las reglas
            iptables-save > /etc/iptables/rules.v4
                            </pre>
                        </div>
                    </div>
                </div>
                <!-- Ejercicio 5 -->
                <div class="accordion-item">
                    <h2 class="accordion-header">
                        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise5">Ejercicio 5: Registrar Tr√°fico en Security_Onion</button>
                    </h2>
                    <div id="exercise5" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
                        <div class="accordion-body">
                            <p><strong>Objetivo:</strong> Configurar IPTables para registrar tr√°fico en Security_Onion.</p>
                            <pre class="bg-dark text-white p-3 rounded">
            # Registrar tr√°fico entrante
            iptables -A INPUT -j LOG --log-prefix "IPTables-INPUT: "
            
            # Registrar tr√°fico saliente
            iptables -A OUTPUT -j LOG --log-prefix "IPTables-OUTPUT: "
            
            # Guardar las reglas
            iptables-save > /etc/iptables/rules.v4
                            </pre>
                        </div>
                    </div>
                </div>
                <!-- Ejercicio 6: Bloquear Acceso a un Sitio Web Espec√≠fico -->
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise6">Ejercicio 6: Bloquear Acceso a un Sitio Web Espec√≠fico</button>
    </h2>
    <div id="exercise6" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
        <div class="accordion-body">
            <p><strong>Objetivo:</strong> Bloquear el acceso a un sitio web espec√≠fico (por ejemplo, <code>example.com</code>) desde <strong>PC1_LAN</strong>.</p>
            <pre class="bg-dark text-white p-3 rounded">
# Bloquear tr√°fico hacia example.com
iptables -A FORWARD -p tcp --dport 80 -m string --string "example.com" --algo bm -j DROP
iptables -A FORWARD -p tcp --dport 443 -m string --string "example.com" --algo bm -j DROP

# Guardar las reglas
iptables-save > /etc/iptables/rules.v4
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>
</div>

<!-- Ejercicio 7: Limitar el N√∫mero de Conexiones por IP -->
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise7">Ejercicio 7: Limitar el N√∫mero de Conexiones por IP</button>
    </h2>
    <div id="exercise7" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
        <div class="accordion-body">
            <p><strong>Objetivo:</strong> Limitar el n√∫mero de conexiones simult√°neas desde una misma IP en <strong>Public_Web</strong>.</p>
            <pre class="bg-dark text-white p-3 rounded">
# Limitar a 10 conexiones simult√°neas por IP
iptables -A INPUT -p tcp --dport 80 -m connlimit --connlimit-above 10 -j DROP

# Guardar las reglas
iptables-save > /etc/iptables/rules.v4
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>
</div>

<!-- Ejercicio 8: Redirigir Tr√°fico a un Puerto Diferente -->
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise8">Ejercicio 8: Redirigir Tr√°fico a un Puerto Diferente</button>
    </h2>
    <div id="exercise8" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
        <div class="accordion-body">
            <p><strong>Objetivo:</strong> Redirigir el tr√°fico del puerto 8080 al puerto 80 en <strong>Public_Web</strong>.</p>
            <pre class="bg-dark text-white p-3 rounded">
# Redirigir tr√°fico del puerto 8080 al puerto 80
iptables -t nat -A PREROUTING -p tcp --dport 8080 -j REDIRECT --to-port 80

# Guardar las reglas
iptables-save > /etc/iptables/rules.v4
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>
</div>

<!-- Ejercicio 9: Bloquear una IP Espec√≠fica -->
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise9">Ejercicio 9: Bloquear una IP Espec√≠fica</button>
    </h2>
    <div id="exercise9" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
        <div class="accordion-body">
            <p><strong>Objetivo:</strong> Bloquear el acceso desde una IP espec√≠fica (por ejemplo, <code>192.168.1.100</code>) a <strong>Endian_UTM</strong>.</p>
            <pre class="bg-dark text-white p-3 rounded">
# Bloquear tr√°fico desde 192.168.1.100
iptables -A INPUT -s 192.168.1.100 -j DROP

# Guardar las reglas
iptables-save > /etc/iptables/rules.v4
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>
</div>

<!-- Ejercicio 10: Crear una Lista Blanca (Whitelist) -->
<div class="accordion-item">
    <h2 class="accordion-header">
        <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise10">Ejercicio 10: Crear una Lista Blanca (Whitelist)</button>
    </h2>
    <div id="exercise10" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
        <div class="accordion-body">
            <p><strong>Objetivo:</strong> Permitir el acceso solo desde IPs espec√≠ficas a <strong>Security_Onion</strong>.</p>
            <pre class="bg-dark text-white p-3 rounded">
# Permitir tr√°fico solo desde 192.168.1.0/24
iptables -A INPUT -s 192.168.1.0/24 -j ACCEPT

# Bloquear todo el tr√°fico entrante no permitido
iptables -A INPUT -j DROP

# Guardar las reglas
iptables-save > /etc/iptables/rules.v4
            </pre>
            <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
        </div>
    </div>


    <h5 class="mt-3">‚ö° Ejercicios Avanzados</h5>
    <ul>
        <li>üîç <strong>Escaneo de Puertos:</strong> Detectar y bloquear intentos sospechosos de escaneo de puertos.</li>
        <li>üåç <strong>Proxy con IPTables:</strong> Redirigir tr√°fico HTTP a un proxy interno.</li>
        <li>üîÑ <strong>Equilibrio de Carga:</strong> Distribuir tr√°fico entre m√∫ltiples servidores.</li>
        <li>üõë <strong>Bloqueo Geo-IP:</strong> Restringir tr√°fico seg√∫n la ubicaci√≥n geogr√°fica.</li>
    </ul>

    <!-- Ejercicio 11: Detectar y Bloquear Escaneo de Puertos -->
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise11">Ejercicio 11: Detectar y Bloquear Escaneo de Puertos</button>
        </h2>
        <div id="exercise11" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
            <div class="accordion-body">
                <p><strong>Objetivo:</strong> Detectar y bloquear intentos sospechosos de escaneo de puertos en <strong>Endian_UTM</strong>.</p>
                <pre class="bg-dark text-white p-3 rounded">
    # Bloquear intentos de escaneo de puertos
    iptables -A INPUT -p tcp --tcp-flags ALL NONE -j DROP
    iptables -A INPUT -p tcp --tcp-flags ALL ALL -j DROP
    
    # Guardar las reglas
    iptables-save > /etc/iptables/rules.v4
                </pre>
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
            </div>
        </div>
    </div>
    
    <!-- Ejercicio 12: Redirigir Tr√°fico HTTP a un Proxy -->
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise12">Ejercicio 12: Redirigir Tr√°fico HTTP a un Proxy</button>
        </h2>
        <div id="exercise12" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
            <div class="accordion-body">
                <p><strong>Objetivo:</strong> Redirigir tr√°fico HTTP desde <strong>PC1_LAN</strong> a un proxy interno en <strong>Endian_UTM</strong>.</p>
                <pre class="bg-dark text-white p-3 rounded">
    # Redirigir tr√°fico HTTP al proxy (puerto 3128)
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 3128
    
    # Guardar las reglas
    iptables-save > /etc/iptables/rules.v4
                </pre>
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
            </div>
        </div>
    </div>
    
    <!-- Ejercicio 13: Equilibrio de Carga entre Servidores -->
    <div class="accordion-item">
        <h2 class="accordion-header">
            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#exercise13">Ejercicio 13: Equilibrio de Carga entre Servidores</button>
        </h2>
        <div id="exercise13" class="accordion-collapse collapse" data-bs-parent="#accordionExercises">
            <div class="accordion-body">
                <p><strong>Objetivo:</strong> Distribuir tr√°fico HTTP entre dos servidores (<strong>Public_Web</strong> y otro servidor).</p>
                <pre class="bg-dark text-white p-3 rounded">
    # Crear un grupo de servidores
    iptables -t nat -A PREROUTING -p tcp --dport 80 -m statistic --mode random --probability 0.5 -j DNAT --to-destination 192.168.2.10:80
    iptables -t nat -A PREROUTING -p tcp --dport 80 -j DNAT --to-destination 192.168.2.20:80
    
    # Guardar las reglas
    iptables-save > /etc/iptables/rules.v4
                </pre>
                <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
            </div>
        </div>
    </div>
    

</div>
</div>




<br>
<h2>ufw</h2>
            <!-- Secci√≥n de ufw -->
            <div id="ufw" class="card shadow mb-4">
                <div class="card-header bg-info text-white"> üí° UFW (Uncomplicated Firewall) en vez de IPTables</div>
                <div class="card-body">
        <p>UFW es una interfaz m√°s sencilla para administrar IPTables. Aqu√≠ hay ejemplos de equivalencias entre IPTables y UFW:</p>
        <pre class="bg-dark text-white p-3 rounded">
# En IPTables:
iptables -A INPUT -p tcp --dport 22 -j ACCEPT

# En UFW:
ufw allow 22/tcp
        </pre>
        <p><strong>Objetivo:</strong> Mostrar que UFW facilita la configuraci√≥n sin perder flexibilidad.</p>
    </div>
</div>
        
<div class="card mb-4">
    <div class="card-body">
        <h2 class="card-title">UFW (Uncomplicated Firewall)</h2>
        <p class="card-text">
            Para una gesti√≥n m√°s sencilla del cortafuegos, especialmente para usuarios que prefieren una interfaz m√°s amigable, se recomienda utilizar UFW (Uncomplicated Firewall), que simplifica la configuraci√≥n de IPTables. UFW proporciona una interfaz de l√≠nea de comandos f√°cil de usar y tambi√©n cuenta con una interfaz gr√°fica llamada Gufw.
        </p>
        
        <h3>Instalaci√≥n y uso b√°sico de UFW</h3>
        
        <h4>Instalar UFW</h4>
        <p>En la mayor√≠a de las distribuciones basadas en Debian, UFW viene preinstalado. Si no es as√≠, puede instalarlo con:</p>
        <pre><code>sudo apt-get install ufw</code></pre>
        
        <h4>Habilitar UFW</h4>
        <p>Antes de habilitarlo, aseg√∫rese de permitir las conexiones SSH para no perder acceso remoto:</p>
        <pre><code>sudo ufw allow ssh
sudo ufw enable</code></pre>
        
        <h4>Permitir o denegar servicios</h4>
        <p>Para permitir el tr√°fico HTTP y HTTPS:</p>
        <pre><code>sudo ufw allow http
sudo ufw allow https</code></pre>
        <p>Para denegar un puerto espec√≠fico, por ejemplo, el 25 (SMTP):</p>
        <pre><code>sudo ufw deny 25</code></pre>
        
        <h4>Ver el estado y las reglas</h4>
        <p>Para comprobar el estado de UFW y las reglas activas:</p>
        <pre><code>sudo ufw status verbose</code></pre>
        
        <p>Para obtener m√°s informaci√≥n sobre la configuraci√≥n de UFW en Ubuntu, puede consultar la <a href="https://help.ubuntu.com/community/UFW" target="_blank">documentaci√≥n oficial de Ubuntu</a>.</p>
        
        <h4>Interfaz gr√°fica (Gufw)</h4>
        <p>Adem√°s, si prefiere una interfaz gr√°fica para gestionar UFW, puede instalar Gufw, que facilita la configuraci√≥n del cortafuegos sin necesidad de utilizar la l√≠nea de comandos.</p>
    </div>
</div>

<!--Herramientas -->
<div class="card shadow mb-4">
    <div class="card-header bg-secondary text-white"> üîÄ Herramientas relacionada</div>
    <div class="card-body">

<table class="table table-bordered">
    <thead>
      <tr>
        <th>Herramienta</th>
        <th>Descripci√≥n</th>
        <th>Enlace</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>nftables</td>
        <td>Sucesor de iptables que proporciona un marco unificado para la filtraci√≥n y clasificaci√≥n de paquetes en Linux. Ofrece una sintaxis m√°s sencilla y flexible, y permite actualizaciones din√°micas de las reglas sin necesidad de reemplazar todo el conjunto de reglas. Desde Debian 11 Bullseye, es la herramienta predeterminada para la gesti√≥n de firewalls.</td>
        <td><a href="https://es.wikipedia.org/wiki/Nftables" target="_blank">Wikipedia</a></td>
      </tr>
      <tr>
        <td>firewalld</td>
        <td>Herramienta de gesti√≥n de firewalls que act√∫a como una interfaz para el marco netfilter del kernel de Linux. Utiliza nftables como backend predeterminado y permite la administraci√≥n de zonas de firewall con diferentes niveles de confianza. Ofrece una interfaz de l√≠nea de comandos y una interfaz gr√°fica opcional para facilitar la configuraci√≥n.</td>
        <td><a href="https://en.wikipedia.org/wiki/Firewalld" target="_blank">Wikipedia</a></td>
      </tr>
      <tr>
        <td>Shorewall</td>
        <td>Herramienta de configuraci√≥n de firewalls que simplifica la creaci√≥n de reglas complejas mediante el uso de archivos de configuraci√≥n en formato de texto plano. Es adecuada para usuarios que prefieren una configuraci√≥n basada en archivos y buscan una mayor flexibilidad en la gesti√≥n de reglas de firewall.</td>
        <td><a href="https://en.wikipedia.org/wiki/Shorewall" target="_blank">Wikipedia</a></td>
      </tr>
      <tr>
        <td>Uncomplicated Firewall (UFW)</td>
        <td>Interfaz simplificada para iptables, dise√±ada para facilitar la gesti√≥n de reglas de firewall en sistemas Linux. Es especialmente popular en distribuciones como Ubuntu y Debian. Aunque no ofrece todas las funcionalidades avanzadas de iptables o nftables, es una opci√≥n adecuada para usuarios que requieren una configuraci√≥n sencilla y r√°pida de su firewall.</td>
        <td><a href="https://es.wikipedia.org/wiki/Uncomplicated_Firewall" target="_blank">Wikipedia</a></td>
      </tr>
    </tbody>
  </table>
</div>

<!-- Secci√≥n de Diagramas Explicativos de IPTables -->
<div class="container mt-5" id="diagramas"><br><br>
    <h2 class="text-center text-primary">Diagramas Explicativos de IPTables</h2>
    <p class="text-center">Visualiza c√≥mo funcionan las reglas y procesamiento de paquetes en IPTables.</p>

    <!-- Diagrama 1: Flujo General de IPTables -->
    <div class="card shadow mb-4">
        <div class="card-header bg-dark text-white">üîÄ Diagrama de Flujo General de IPTables</div>
        <div class="card-body text-center">
            <img src="img/iptable/flujo.png" alt="Diagrama Flujo General IPTables" class="img-fluid">
            <p class="mt-2">Este diagrama muestra c√≥mo los paquetes viajan a trav√©s de las cadenas principales: INPUT, FORWARD y OUTPUT.</p>
        </div>
    </div>

    <!-- Diagrama 2: Decisi√≥n de Reglas -->
    <div class="card shadow mb-4">
        <div class="card-header bg-secondary text-white">‚ùî Diagrama de Decisi√≥n para Reglas IPTables</div>
        <div class="card-body text-center">
            <img src="img/iptable/decision.png" alt="Diagrama Decisi√≥n Reglas IPTables" class="img-fluid">
            <p class="mt-2">Explica c√≥mo IPTables eval√∫a cada paquete y decide si lo acepta, rechaza o descarta.</p>
        </div>
    </div>

    <!-- Diagrama 3: Estados de Conexi√≥n -->
    <div class="card shadow mb-4">
        <div class="card-header bg-info text-white">üïµÔ∏è Diagrama de Estados de Conexi√≥n en IPTables</div>
        <div class="card-body text-center">
            <img src="img/iptable/estados.png" alt="Diagrama Estados de Conexi√≥n IPTables" class="img-fluid">
            <p class="mt-2">Visualiza c√≥mo se manejan los estados de conexi√≥n como NEW, ESTABLISHED, RELATED e INVALID.</p>
        </div>
    </div>

    <!-- Diagrama 4: NAT en IPTables -->
    <div class="card shadow mb-4">
        <div class="card-header bg-success text-white">üåç Diagrama de Traducci√≥n de Direcciones (NAT)</div>
        <div class="card-body text-center">
            <img src="img/iptable/nat.png" alt="Diagrama NAT IPTables" class="img-fluid">
            <p class="mt-2">Ilustra el proceso de NAT, incluyendo DNAT (redirecci√≥n de tr√°fico) y SNAT (cambio de direcci√≥n de origen).</p>
        </div>
    </div>

    <!-- Diagrama 5: Registro de Logs -->
    <div class="card shadow mb-4">
        <div class="card-header bg-warning text-dark">üìú Diagrama de Registro de Logs en IPTables</div>
        <div class="card-body text-center">
            <img src="img/iptable/logs.png" alt="Diagrama Registro Logs IPTables" class="img-fluid">
            <p class="mt-2">Muestra c√≥mo IPTables registra tr√°fico en syslog para auditor√≠a y monitoreo de eventos.</p>
        </div>
    </div>
</div>




<!-- An√°lisis de Logs -->
<div class="card shadow mb-4">
    <div class="card-header bg-warning text-white">üìú An√°lisis de Logs de IPTables</div>
    <div class="card-body">
        <p>Los logs de IPTables se registran en <code>/var/log/syslog</code>. Aqu√≠ hay ejemplos de c√≥mo analizarlos:</p>
        <pre class="bg-dark text-white p-3 rounded">
# Ver logs en tiempo real
tail -f /var/log/syslog | grep IPTables

# Ejemplo de log:
# Nov  1 12:34:56 server kernel: [IPTables-INPUT] IN=eth0 OUT= MAC=00:11:22:33:44:55 SRC=192.168.1.100 DST=192.168.1.1 LEN=60 TOS=0x00 PREC=0x00 TTL=64 ID=12345 DF PROTO=TCP SPT=54321 DPT=22 WINDOW=64240 RES=0x00 SYN URGP=0
        </pre>
        <p><strong>Informaci√≥n Relevante:</strong></p>
        <ul>
            <li><strong>SRC:</strong> Direcci√≥n IP de origen.</li>
            <li><strong>DST:</strong> Direcci√≥n IP de destino.</li>
            <li><strong>PROTO:</strong> Protocolo (TCP, UDP, ICMP).</li>
            <li><strong>SPT/DPT:</strong> Puerto de origen/destino.</li>
        </ul>
    </div>
</div>


            </div>
            
            

            <!-- Footer -->
            <footer class="mt-5 text-center text-muted">
                <p>Desarrollado con ‚ù§Ô∏è usando Bootstrap y ChatGPT | <a href="#" class="text-decoration-none">Recursos Adicionales</a></p>
            </footer>
        </div>

        <!-- Script para copiar c√≥digo -->
        <script>
            function copyCode(button) {
                const code = button.previousElementSibling.textContent;
                navigator.clipboard.writeText(code).then(() => {
                    button.textContent = "¬°Copiado!";
                    setTimeout(() => button.textContent = "Copiar", 2000);
                });
            }
        </script>
    </body>
    </html>
